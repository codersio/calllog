import{r as c,W as k,j as s}from"./app-DFTNfJ2u.js";import{H as $,N as F}from"./Nav-CWswFE9u.js";import{N as C}from"./notyf.min-DLu_xjpT.js";import{M as O}from"./index-GaVBAoJ7.js";import"./index-BjoqcNMp.js";const j=new C,L=({project:d,employees:h,user:f,user_type:g,notif:y})=>{const[m,p]=c.useState(d.assignments.map(e=>e.employee_id)||[]),[n,_]=c.useState(d.assignments.reduce((e,t)=>(e[t.employee_id]=t.employee_hours||"",e),{})),[a,x]=c.useState({}),{data:r,setData:o,post:E}=k({task_name:d.task_name||"",estimate_hours:d.estimate_hours||"",estimate_budget:d.estimate_budget||"",sdate:d.sdate||"",edate:d.edate||"",employee_id:m||[],employee_hours:n||{}}),v=40,b=e=>{e.preventDefault();const t=Object.values(n).reduce((l,i)=>l+parseFloat(i||0),0);if(t>parseFloat(r.estimate_hours)){j.error(`Total employee hours (${t} hours) exceed the task estimate of ${r.estimate_hours} hours.`);return}E(`/task-update/${d.id}`,{onSuccess:()=>{j.success("Task updated successfully")}})},N=e=>{const t=e.map(l=>l.id);p(t),o("employee_id",t)},S=e=>{const t=e.map(i=>i.id);p(t),o("employee_id",t);const l={...n};t.forEach(i=>{m.includes(i)||delete l[i]}),_(l),o("employee_hours",l)},w=(e,t)=>{const l=parseFloat(t),i={...n,[e]:t};if(l>v)x(u=>({...u,[`employee_hours_${e}`]:`Estimated hours for this employee cannot exceed ${v} hours.`}));else{const u={...a};delete u[`employee_hours_${e}`],x(u)}_(i),o("employee_hours",i)};return s.jsxs("div",{className:"w-[85.2%] ml-[12rem]",children:[s.jsx($,{user:f,notif:y}),s.jsx(F,{user_type:g}),s.jsxs("form",{onSubmit:b,className:"px-[8rem] grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"title",children:"Title:"}),s.jsx("input",{className:"w-full rounded-lg",type:"text",id:"title",value:r.task_name,onChange:e=>o("task_name",e.target.value)}),a.task_name&&s.jsx("div",{children:a.task_name})]}),d.task_name!=="NON-BILLABLE"&&s.jsxs("div",{children:[s.jsx("label",{htmlFor:"estimate_hours",children:"Estimate Time:"}),s.jsx("input",{className:"w-full rounded-lg",type:"text",id:"estimate_hours",value:r.estimate_hours,onChange:e=>o("estimate_hours",e.target.value)}),a.estimate_hours&&s.jsx("div",{children:a.estimate_hours})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"start_date",children:"Start Date:"}),s.jsx("input",{className:"w-full rounded-lg",type:"date",id:"sdate",value:r.sdate,onChange:e=>o("sdate",e.target.value)}),a.sdate&&s.jsx("div",{children:a.sdate})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"end_date",children:"End Date:"}),s.jsx("input",{className:"w-full rounded-lg",type:"date",id:"edate",value:r.edate,onChange:e=>o("edate",e.target.value)}),a.edate&&s.jsx("div",{children:a.edate})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"employees",children:"Assign Employees:"}),s.jsx(O,{options:h,selectedValues:h.filter(e=>m.includes(e.id)),onSelect:N,onRemove:S,displayValue:"name",className:"w-full rounded-lg"}),a.employee_id&&s.jsx("div",{children:a.employee_id})]}),m.map(e=>{var t;return s.jsxs("div",{children:[s.jsxs("label",{htmlFor:`estimate_time_${e}`,children:["Estimate Time for ",(t=h.find(l=>l.id===e))==null?void 0:t.name,":"]}),s.jsx("input",{type:"text",id:`employee_hours_${e}`,value:n[e]||"",onChange:l=>w(e,l.target.value),className:"w-full rounded-lg"}),a[`employee_hours_${e}`]&&s.jsx("div",{children:a[`employee_hours_${e}`]})]},e)}),s.jsx("br",{}),s.jsx("button",{type:"submit",className:"bg-blue-600 p-2 rounded-md text-white w-[30%]",children:"Save"})]})]})};export{L as default};
