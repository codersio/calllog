import{r as u,W as R,j as e}from"./app-bBQMqR6O.js";import{A as P}from"./AdminLayout-BHjzgd9T.js";import{r as M}from"./index-BtE-ENE6.js";import{N as I}from"./notyf.min-DLu_xjpT.js";import"./Dropdown-BP-MPy4X.js";import"./index-CYmrYT0Q.js";const y=new I;function q({customers:f,products:j,employees:v,amc:a,intvls:g}){const[x,h]=u.useState(a.amc_details||[{product:"",note:""}]),[c,C]=u.useState(a.interval),[m,N]=u.useState(a.no_of_service),[p,_]=u.useState(a.service_details||[]),{put:S,data:n,setData:r,errors:t,processing:k}=R({amc_no:a.amc_no,contact_person:a.contact_person,date:a.date,customer_id:a.customer_id,mobile_no:a.mobile_no,assigned_to:a.assigned_to,email:a.email,status:a.status,interval:"",details:a.details,attachments:"",no_of_service:"",billing_address:a.billing_address,service_details:[],amc_details:[]});u.useEffect(()=>{if((c!==a.interval||m!==a.no_of_service)&&c&&m){const s=new Date(n.date||new Date),l=Array.from({length:m},(d,o)=>{const i=new Date(s);return i.setMonth(s.getMonth()+o*c),{id:o+1,date:i.toISOString().split("T")[0],service:`${o+1} Service`}});_(l)}},[c,m,n.date]);function A(s){if(!c){alert("Please select interval first"),N("");return}N(Number(s.target.value))}const b=(s,l,d)=>{_(o=>o.map(i=>i.id===s?{...i,[l]:d}:i))};u.useEffect(()=>{r(s=>({...s,amc_details:x,no_of_service:m,interval:c,service_details:p}))},[x,m,c,p]);const F=()=>{h([...x,{product:"",note:""}])},E=s=>{const l=x.filter((d,o)=>o!==s);h(l)},w=(s,l,d)=>{const o=x.map((i,O)=>O===s?{...i,[l]:d}:i);h(o)};function D(s){s.preventDefault(),S(route("amc.update",a.id),{onSuccess:()=>{y.success("Amc updated successfully!")},onError:l=>{console.log(l),y.error("Failed to add amc. Please check your inputs.")}})}return e.jsx(P,{children:e.jsxs("div",{className:"max-w-5xl p-8 mx-auto bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"mb-6 text-2xl font-bold text-gray-800",children:"Edit Amc"}),e.jsxs("form",{onSubmit:D,className:"flex flex-wrap",children:[e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"AMC No."}),e.jsx("input",{onChange:s=>r("amc_no",s.target.value),value:n.amc_no,type:"text",className:"form-input w-full rounded",placeholder:"Enter bill no"}),t.amc_no&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.amc_no})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Date"}),e.jsx("input",{type:"date",name:"date",onChange:s=>r("date",s.target.value),value:n.date,className:"form-input w-full rounded",placeholder:"Enter bill no"}),t.date&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.date})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Contact Person"}),e.jsx("input",{type:"text",name:"contact_person",onChange:s=>r("contact_person",s.target.value),value:n.contact_person,className:"form-input w-full rounded",placeholder:"Enter bill no"}),t.contact_person&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.contact_person})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Status"}),e.jsxs("select",{name:"status",onChange:s=>r("status",s.target.value),value:n.status,className:"form-select w-full rounded",id:"",children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"progress",children:"Progress"}),e.jsx("option",{value:"closed",children:"Closed"})]}),t.status&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.status})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Customer Name"}),e.jsxs("select",{name:"",onChange:s=>r("customer_id",s.target.value),value:n.customer_id,className:"form-select w-full rounded",id:"",children:[e.jsx("option",{value:"",children:"-- Select Customer --"}),f&&f.map((s,l)=>e.jsx("option",{value:s.user_id,children:s.first_name+" "+s.middle_name+" "+s.last_name}))]}),t.customer_id&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.customer_id})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Mobile No"}),e.jsx("input",{type:"tel",onChange:s=>r("mobile_no",s.target.value),value:n.mobile_no,className:"form-input w-full rounded",placeholder:"Enter mobile no"}),t.mobile_no&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.mobile_no})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Email"}),e.jsx("input",{type:"email",onChange:s=>r("email",s.target.value),value:n.email,className:"form-input w-full rounded",placeholder:"Enter email"}),t.email&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.email})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Assigned To"}),e.jsxs("select",{name:"",onChange:s=>r("assigned_to",s.target.value),value:n.assigned_to,className:"form-select w-full rounded",id:"",children:[e.jsx("option",{value:"",children:"-- Select Assigned --"}),v&&v.map((s,l)=>e.jsx("option",{value:s.user_id,children:s.first_name+" "+s.middle_name+" "+s.last_name},l))]}),t.assigned_to&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.assigned_to})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Amc Details"}),e.jsx("textarea",{name:"",onChange:s=>r("details",s.target.value),value:n.details,id:"",rows:3,className:"form-textarea resize-none w-full rounded"}),t.details&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.details})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Billing Address"}),e.jsx("textarea",{name:"",onChange:s=>r("billing_address",s.target.value),value:n.billing_address,id:"",rows:3,className:"form-textarea resize-none w-full rounded"}),t.billing_address&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.billing_address})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"attachments",children:"Attachments"}),e.jsx("input",{type:"file",onChange:s=>r("attachments",s.target.files[0]),className:"form-input"}),t.attachments&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.attachments})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Interval"}),e.jsxs("select",{name:"",value:c,onChange:s=>C(Number(s.target.value)),className:"form-select w-full rounded",id:"",children:[e.jsx("option",{value:"",children:"-- No Of Interval --"}),g&&g.map((s,l)=>e.jsx("option",{value:s.id,children:s.name+" Month"},l))]}),t.interval&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.interval})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"No Of Service"}),e.jsxs("select",{name:"",value:m,onChange:A,className:"form-select w-full rounded",id:"",children:[e.jsx("option",{value:"",children:"-- No Of Service --"}),Array.from({length:12},(s,l)=>l+1).map(s=>e.jsx("option",{value:s,children:s},s))]}),t.no_of_service&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:t.no_of_service})]}),e.jsx("div",{className:"w-full py-3",children:p.map(s=>e.jsxs("div",{className:"flex items-center space-x-4 border-b pb-4",children:[e.jsx("div",{className:"w-10 text-center",children:s.id}),e.jsx("input",{type:"date",value:s.date,onChange:l=>b(s.id,"date",l.target.value),className:"border border-gray-300 rounded px-2 py-1 bg-gray-100 w-1/3"}),e.jsx("input",{type:"text",value:s.service,onChange:l=>b(s.id,"service",l.target.value),className:"border border-gray-300 rounded px-2 py-1 bg-gray-100 w-1/3"})]},s.id))}),e.jsx("hr",{}),e.jsx("div",{className:"w-full py-2",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-600",children:"Amc Details"})}),e.jsxs("div",{className:"w-full py-2",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 p-2",children:"Product"}),e.jsx("th",{className:"border border-gray-300 p-2",children:"Notes"}),e.jsx("th",{className:"border border-gray-300 p-2",children:"Action"})]})}),e.jsx("tbody",{children:x.map((s,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:"form-select rounded w-full",value:s.product,onChange:d=>w(l,"product",d.target.value),children:[e.jsx("option",{value:"",children:"-- Select Product --"}),j&&j.map((d,o)=>e.jsx("option",{value:d.item_name,children:d.item_name},o))]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"text",className:"form-input rounded w-full",value:s.note,onChange:d=>w(l,"note",d.target.value)})}),e.jsx("td",{className:"p-2",children:l!==0&&e.jsxs("button",{type:"button",className:"flex gap-1 items-center text-sm font-medium text-red-500",onClick:()=>E(l),children:[e.jsx(M,{size:15}),e.jsx("span",{children:"Delete"})]})})]},l))})]}),e.jsx("button",{type:"button",className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded",onClick:F,children:"Add Row"})]}),e.jsx("div",{className:"w-full py-5",children:e.jsx("button",{className:"py-2 px-6 text-sm bg-rose-600 rounded font-medium text-white",children:"Edit Amc"})})]})]})})}export{q as default};
