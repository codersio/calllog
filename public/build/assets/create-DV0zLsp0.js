import{r as x,W as S,j as e}from"./app-BV8Hs2DA.js";import{A as C}from"./AdminLayout-7Wm0VRsv.js";import{r as A}from"./index-B8hqPStr.js";import{N as R}from"./notyf.min-DLu_xjpT.js";import{M as F}from"./index-C5t-_n1R.js";import"./Dropdown-4iDllGMy.js";import"./index-BfhOz7Dm.js";const g=new R;function B({suppliers:h,products:j,taxes:b}){const[d,u]=x.useState([{product:"",quantity:0,price:0,amount:0,amountWithTax:0,selectedTaxes:[]}]),[P,v]=x.useState(0),y=()=>{u([...d,{product:"",quantity:0,price:0,amount:0,amountWithTax:0,selectedTaxes:[]}])},w=t=>{const s=d.filter((a,l)=>l!==t);u(s)},m=(t,s,a)=>{const l=d.map((n,p)=>{if(p===t){const i={...n,[s]:s==="product"?a:Number(a)};return(s==="quantity"||s==="price")&&(i.amount=i.quantity*i.price),i}return n});u(l),N(l)},f=(t,s)=>{const a=d.map((l,n)=>n===t?{...l,selectedTaxes:s}:l);u(a),N(a)},N=t=>{console.log(t);const s=t.map(l=>{const n=l.selectedTaxes.reduce((p,i)=>p+l.amount*(i.percent/100),0);return l.amountWithTax=l.amount+n,l}),a=s.reduce((l,n)=>l+(n.amountWithTax-n.amount),0);v(a),u(s)},{post:_,data:o,setData:c,errors:r,processing:E}=S({purchase_no:"",status:"",date:"",contact_person:"",supplier_id:"",email:"",billing_address:"",sales_details:[]});x.useEffect(()=>{c(t=>({...t,sales_details:d||[]}))},[d]);function T(t){t.preventDefault(),_(route("purchase.store"),{onSuccess:()=>{g.success("Purchase added successfully!")},onError:()=>{g.error("Failed to add purchase. Please check your inputs.")}})}return e.jsx(C,{children:e.jsxs("div",{className:"max-w-5xl p-8 mx-auto bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"mb-6 text-2xl font-bold text-gray-800",children:"Add Purchase"}),e.jsxs("form",{onSubmit:T,className:"flex flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Purchase No."}),e.jsx("input",{onChange:t=>c("purchase_no",t.target.value),value:o.purchase_no,type:"text",className:"w-full rounded form-input",placeholder:"Enter bill no"}),r.purchase_no&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.purchase_no})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Status"}),e.jsxs("select",{name:"status",onChange:t=>c("status",t.target.value),value:o.status,className:"w-full rounded form-select",id:"",children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"0",children:"Pending"}),e.jsx("option",{value:"1",children:"Approved"})]}),r.status&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.status})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Purchase Date"}),e.jsx("input",{type:"date",name:"date",onChange:t=>c("date",t.target.value),value:o.date,className:"w-full rounded form-input",placeholder:"Enter bill no"}),r.date&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.date})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Contact Person"}),e.jsx("input",{type:"text",onChange:t=>c("contact_person",t.target.value),value:o.contact_person,className:"w-full rounded form-input",placeholder:"Enter contact person"}),r.contact_person&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.contact_person})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Supplier"}),e.jsxs("select",{name:"",onChange:t=>c("supplier_id",t.target.value),value:o.supplier_id,className:"w-full rounded form-select",id:"",children:[e.jsx("option",{value:"",children:"-- Select Supplier --"}),h&&h.map((t,s)=>e.jsx("option",{value:t.id,children:t.name},s))]}),r.customer_id&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.customer_id})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Email"}),e.jsx("input",{type:"email",onChange:t=>c("email",t.target.value),value:o.email,className:"w-full rounded form-input",placeholder:"Enter email"}),r.email&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.email})]}),e.jsxs("div",{className:"flex flex-col w-full gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Billing Address"}),e.jsx("textarea",{name:"",onChange:t=>c("billing_address",t.target.value),value:o.billing_address,id:"",rows:2,className:"w-full rounded resize-none form-textarea"}),r.billing_address&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.billing_address})]}),e.jsx("hr",{}),e.jsx("div",{className:"w-full py-2",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-600",children:"Sales Details"})}),e.jsxs("div",{className:"w-full py-2",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border border-gray-300",children:"Product"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Quantity"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Price (Af)"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Tax"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Amount (Af)"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Action"})]})}),e.jsx("tbody",{children:d.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:"w-full rounded form-select",value:t.product,onChange:a=>m(s,"product",a.target.value),children:[e.jsx("option",{value:"",children:"-- Select Product --"}),j&&j.map((a,l)=>e.jsx("option",{value:a.name,children:a.name},l))]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full rounded form-input",value:t.quantity,onChange:a=>m(s,"quantity",a.target.value)})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full rounded form-input",value:t.price,onChange:a=>m(s,"price",a.target.value)})}),e.jsx("td",{className:"p-2",children:e.jsx(F,{options:b.map(a=>({name:`${a.name} (${a.percent}%)`,percent:a.percent})),onSelect:a=>f(s,a),onRemove:a=>f(s,a),displayValue:"name"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full rounded form-input",value:t.amountWithTax.toFixed(2),readOnly:!0})}),e.jsx("td",{className:"p-2",children:s!==0&&e.jsxs("button",{type:"button",className:"flex items-center gap-1 text-sm font-medium text-red-500",onClick:()=>w(s),children:[e.jsx(A,{size:15}),e.jsx("span",{children:"Delete"})]})})]},s))})]}),e.jsx("button",{type:"button",className:"px-4 py-2 mt-4 text-white bg-blue-500 rounded",onClick:y,children:"Add Row"})]}),e.jsx("div",{className:"w-full py-5",children:e.jsx("button",{className:"px-6 py-2 text-sm font-medium text-white rounded bg-rose-600",children:"Add Sale"})})]})]})})}export{B as default};
