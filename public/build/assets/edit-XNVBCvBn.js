import{r as h,W as S,j as e}from"./app-CwTpoyqh.js";import{A as F}from"./AdminLayout-DQmQe51a.js";import{q as A}from"./index-DXOuEoXo.js";import{N as R}from"./notyf.min-DLu_xjpT.js";import{M as E}from"./index-CfJux8De.js";import"./Dropdown-C_Ing8xx.js";import"./index-CBtgs9-R.js";const g=new R;function V({customers:j,products:f,sale:r,taxes:v}){const[i,u]=h.useState(r.sales_details);console.log(r.sales_details);const[D,y]=h.useState(0),_=()=>{u([...i,{product:"",quantity:0,price:0,amount:0,amountWithTax:0,selectedTaxes:[]}])},w=l=>{const a=i.filter((t,n)=>n!==l);u(a)},x=(l,a,t)=>{const n=i.map((c,p)=>{if(p===l){const m={...c,[a]:a==="product"?t:Number(t)};return(a==="quantity"||a==="price")&&(m.amount=m.quantity*m.price),m}return c});u(n),N(n)},b=(l,a)=>{const t=i.map((n,c)=>c===l?{...n,selectedTaxes:a}:n);u(t),N(t)},N=l=>{console.log(l);const a=l.map(n=>{const c=n.selectedTaxes.reduce((p,m)=>p+n.amount*(m.percent/100),0);return n.amountWithTax=n.amount+c,n}),t=a.reduce((n,c)=>n+(c.amountWithTax-c.amount),0);y(t),u(a)};console.log(r);const{put:C,data:o,setData:d,errors:s,processing:q}=S({bill_no:r.bill_no,status:r.status,date:r.date,customer_id:r.customer_id,mobile_no:r.mobile_no,amc_type:r.amc_type,email:r.email,discount:r.discount,billing_address:r.billing_address,sales_details:i});h.useEffect(()=>{d(l=>({...l,sales_details:i||[]}))},[i]);function T(l){l.preventDefault(),C(route("sales.edit",r.id),{onSuccess:()=>{g.success("sales updated successfully!")},onError:()=>{g.error("Failed to add sales. Please check your inputs.")}})}return e.jsx(F,{children:e.jsxs("div",{className:"max-w-5xl p-8 mx-auto bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"mb-6 text-2xl font-bold text-gray-800",children:"Edit Sales"}),e.jsxs("form",{onSubmit:T,className:"flex flex-wrap",children:[e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Bill No."}),e.jsx("input",{onChange:l=>d("bill_no",l.target.value),value:o.bill_no,type:"text",className:"form-input w-full rounded",placeholder:"Enter bill no"}),s.bill_no&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.bill_no})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Status"}),e.jsxs("select",{name:"status",onChange:l=>d("status",l.target.value),value:o.status,className:"form-select w-full rounded",id:"",children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"unpaid",children:"Unpaid"}),e.jsx("option",{value:"full_paid",children:"Full Paid"}),e.jsx("option",{value:"half_paid",children:"Half Paid"})]}),s.status&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.status})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Sales Date"}),e.jsx("input",{type:"date",name:"date",onChange:l=>d("date",l.target.value),value:o.date,className:"form-input w-full rounded",placeholder:"Enter bill no"}),s.date&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.date})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Customer Name"}),e.jsxs("select",{name:"",onChange:l=>d("customer_id",l.target.value),value:o.customer_id,className:"form-select w-full rounded",id:"",children:[e.jsx("option",{value:"",children:"-- Select Customer --"}),j&&j.map((l,a)=>e.jsx("option",{value:l.user_id,children:l.first_name+" "+l.middle_name+" "+l.last_name},a))]}),s.customer_id&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.customer_id})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Mobile No"}),e.jsx("input",{type:"tel",onChange:l=>d("mobile_no",l.target.value),value:o.mobile_no,className:"form-input w-full rounded",placeholder:"Enter mobile no"}),s.mobile_no&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.mobile_no})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"AMC Type"}),e.jsxs("select",{name:"",onChange:l=>d("amc_type",l.target.value),value:o.amc_type,className:"form-select w-full rounded",id:"",children:[e.jsx("option",{value:"no_amc",children:"No AMC"}),e.jsx("option",{value:"amc",children:"AMC"})]}),s.amc_type&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.amc_type})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Email"}),e.jsx("input",{type:"email",onChange:l=>d("email",l.target.value),value:o.email,className:"form-input w-full rounded",placeholder:"Enter email"}),s.email&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.email})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-1/2",children:[e.jsx("label",{htmlFor:"",children:"Discount"}),e.jsx("input",{type:"number",onChange:l=>d("discount",l.target.value),value:o.discount,className:"form-input w-full rounded",placeholder:"Enter discount"}),s.discount&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.discount})]}),e.jsxs("div",{className:"flex flex-col gap-2 p-2 w-full",children:[e.jsx("label",{htmlFor:"",children:"Billing Address"}),e.jsx("textarea",{name:"",onChange:l=>d("billing_address",l.target.value),value:o.billing_address,id:"",rows:2,className:"form-textarea resize-none w-full rounded"}),s.billing_address&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.billing_address})]}),e.jsx("hr",{}),e.jsx("div",{className:"w-full py-2",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-600",children:"Sales Details"})}),e.jsxs("div",{className:"w-full py-2",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 p-2",children:"Product"}),e.jsx("th",{className:"border border-gray-300 p-2",children:"Quantity"}),e.jsx("th",{className:"border border-gray-300 p-2",children:"Price (Af)"}),e.jsx("th",{className:"border border-gray-300 p-2",children:"Tax"}),e.jsx("th",{className:"border border-gray-300 p-2",children:"Amount (Af)"}),e.jsx("th",{className:"border border-gray-300 p-2",children:"Action"})]})}),e.jsx("tbody",{children:i.map((l,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:"form-select rounded w-full",value:l.product,onChange:t=>x(a,"product",t.target.value),children:[e.jsx("option",{value:"",children:"-- Select Product --"}),f&&f.map((t,n)=>e.jsx("option",{value:t.item_name,children:t.item_name},n))]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"form-input rounded w-full",value:l.quantity,onChange:t=>x(a,"quantity",t.target.value)})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"form-input rounded w-full",value:l.price,onChange:t=>x(a,"price",t.target.value)})}),e.jsx("td",{className:"p-2",children:e.jsx(E,{options:v.map(t=>({name:`${t.name} (${t.percent}%)`,percent:t.percent})),selectedValues:l.selectedTaxes,onSelect:t=>b(a,t),onRemove:t=>b(a,t),displayValue:"name"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"form-input rounded w-full",value:l.amountWithTax.toFixed(2),readOnly:!0})}),e.jsx("td",{className:"p-2",children:a!==0&&e.jsxs("button",{type:"button",className:"flex gap-1 items-center text-sm font-medium text-red-500",onClick:()=>w(a),children:[e.jsx(A,{size:15}),e.jsx("span",{children:"Delete"})]})})]},a))})]}),e.jsx("button",{type:"button",className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded",onClick:_,children:"Add Row"})]}),e.jsx("div",{className:"w-full py-5",children:e.jsx("button",{className:"py-2 px-6 text-sm bg-rose-600 rounded font-medium text-white",children:"Update Sale"})})]})]})})}export{V as default};
