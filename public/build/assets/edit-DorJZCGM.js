import{r as h,W as C,j as e}from"./app-BV8Hs2DA.js";import{A as R}from"./AdminLayout-7Wm0VRsv.js";import{r as F}from"./index-B8hqPStr.js";import{N as A}from"./notyf.min-DLu_xjpT.js";import{M as E}from"./index-C5t-_n1R.js";import"./Dropdown-4iDllGMy.js";import"./index-BfhOz7Dm.js";const b=new A;function L({suppliers:j,products:f,taxes:v,pur:n}){const[o,m]=h.useState(n.sales_details),[P,y]=h.useState(0),w=()=>{m([...o,{product:"",quantity:0,price:0,amount:0,amountWithTax:0,selectedTaxes:[]}])},_=t=>{const s=o.filter((a,l)=>l!==t);m(s)},p=(t,s,a)=>{const l=o.map((c,x)=>{if(x===t){const u={...c,[s]:s==="product"?a:Number(a)};return(s==="quantity"||s==="price")&&(u.amount=u.quantity*u.price),u}return c});m(l),g(l)},N=(t,s)=>{const a=o.map((l,c)=>c===t?{...l,selectedTaxes:s}:l);m(a),g(a)},g=t=>{console.log(t);const s=t.map(l=>{const c=l.selectedTaxes.reduce((x,u)=>x+l.amount*(u.percent/100),0);return l.amountWithTax=l.amount+c,l}),a=s.reduce((l,c)=>l+(c.amountWithTax-c.amount),0);y(a),m(s)},{put:T,data:i,setData:d,errors:r,processing:D}=C({purchase_no:n.purchase_no,status:n.status,date:n.date,contact_person:n.contact_person,supplier_id:n.supplier_id,email:n.email,billing_address:n.billing_address,sales_details:[]});h.useEffect(()=>{d(t=>({...t,sales_details:o||[]}))},[o]);function S(t){t.preventDefault(),T(route("purchase.update",n.id),{onSuccess:()=>{b.success("Purchase updated successfully!")},onError:()=>{b.error("Failed to update purchase. Please check your inputs.")}})}return e.jsx(R,{children:e.jsxs("div",{className:"max-w-5xl p-8 mx-auto bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"mb-6 text-2xl font-bold text-gray-800",children:"Edit Purchase"}),e.jsxs("form",{onSubmit:S,className:"flex flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Purchase No."}),e.jsx("input",{onChange:t=>d("purchase_no",t.target.value),value:i.purchase_no,type:"text",className:"w-full rounded form-input",placeholder:"Enter bill no"}),r.purchase_no&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.purchase_no})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Status"}),e.jsxs("select",{name:"status",onChange:t=>d("status",t.target.value),value:i.status,className:"w-full rounded form-select",id:"",children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"0",children:"Pending"}),e.jsx("option",{value:"1",children:"Approved"})]}),r.status&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.status})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Purchase Date"}),e.jsx("input",{type:"date",name:"date",onChange:t=>d("date",t.target.value),value:i.date,className:"w-full rounded form-input",placeholder:"Enter bill no"}),r.date&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.date})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Contact Person"}),e.jsx("input",{type:"text",onChange:t=>d("contact_person",t.target.value),value:i.contact_person,className:"w-full rounded form-input",placeholder:"Enter contact person"}),r.contact_person&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.contact_person})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Supplier"}),e.jsxs("select",{name:"",onChange:t=>d("supplier_id",t.target.value),value:i.supplier_id,className:"w-full rounded form-select",id:"",children:[e.jsx("option",{value:"",children:"-- Select Supplier --"}),j&&j.map((t,s)=>e.jsx("option",{value:t.id,children:t.name},s))]}),r.customer_id&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.customer_id})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Email"}),e.jsx("input",{type:"email",onChange:t=>d("email",t.target.value),value:i.email,className:"w-full rounded form-input",placeholder:"Enter email"}),r.email&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.email})]}),e.jsxs("div",{className:"flex flex-col w-full gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Billing Address"}),e.jsx("textarea",{name:"",onChange:t=>d("billing_address",t.target.value),value:i.billing_address,id:"",rows:2,className:"w-full rounded resize-none form-textarea"}),r.billing_address&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:r.billing_address})]}),e.jsx("hr",{}),e.jsx("div",{className:"w-full py-2",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-600",children:"Sales Details"})}),e.jsxs("div",{className:"w-full py-2",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border border-gray-300",children:"Product"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Quantity"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Price (Af)"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Tax"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Amount (Af)"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Action"})]})}),e.jsx("tbody",{children:o.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:"w-full rounded form-select",value:t.product,onChange:a=>p(s,"product",a.target.value),children:[e.jsx("option",{value:"",children:"-- Select Product --"}),f&&f.map((a,l)=>e.jsx("option",{value:a.name,children:a.name},l))]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full rounded form-input",value:t.quantity,onChange:a=>p(s,"quantity",a.target.value)})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full rounded form-input",value:t.price,onChange:a=>p(s,"price",a.target.value)})}),e.jsx("td",{className:"p-2",children:e.jsx(E,{options:v.map(a=>({name:`${a.name} (${a.percent}%)`,percent:a.percent})),onSelect:a=>N(s,a),onRemove:a=>N(s,a),displayValue:"name"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full rounded form-input",value:t.amountWithTax.toFixed(2),readOnly:!0})}),e.jsx("td",{className:"p-2",children:s!==0&&e.jsxs("button",{type:"button",className:"flex items-center gap-1 text-sm font-medium text-red-500",onClick:()=>_(s),children:[e.jsx(F,{size:15}),e.jsx("span",{children:"Delete"})]})})]},s))})]}),e.jsx("button",{type:"button",className:"px-4 py-2 mt-4 text-white bg-blue-500 rounded",onClick:w,children:"Add Row"})]}),e.jsx("div",{className:"w-full py-5",children:e.jsx("button",{className:"px-6 py-2 text-sm font-medium text-white rounded bg-rose-600",children:"Update Sale"})})]})]})})}export{L as default};
