import{r as p,W as S,j as e}from"./app-bBQMqR6O.js";import{A}from"./AdminLayout-BHjzgd9T.js";import{r as F}from"./index-BtE-ENE6.js";import{N as R}from"./notyf.min-DLu_xjpT.js";import{M as E}from"./index-CooroP6z.js";import"./Dropdown-BP-MPy4X.js";import"./index-CYmrYT0Q.js";const b=new R;function $({customers:h,products:j,taxes:g,blno:v}){const[c,m]=p.useState([{product:"",quantity:0,price:0,amount:0,amountWithTax:0,selectedTaxes:[]}]),[D,y]=p.useState(0),_=()=>{m([...c,{product:"",quantity:0,price:0,amount:0,amountWithTax:0,selectedTaxes:[]}])},w=l=>{const a=c.filter((t,n)=>n!==l);m(a)},u=(l,a,t)=>{const n=c.map((o,x)=>{if(x===l){const i={...o,[a]:a==="product"?t:Number(t)};return(a==="quantity"||a==="price")&&(i.amount=i.quantity*i.price),i}return o});m(n),N(n)},f=(l,a)=>{const t=c.map((n,o)=>o===l?{...n,selectedTaxes:a}:n);m(t),N(t)},N=l=>{console.log(l);const a=l.map(n=>{const o=n.selectedTaxes.reduce((x,i)=>x+n.amount*(i.percent/100),0);return n.amountWithTax=n.amount+o,n}),t=a.reduce((n,o)=>n+(o.amountWithTax-o.amount),0);y(t),m(a)},{post:T,data:r,setData:d,errors:s,processing:q}=S({bill_no:v,status:"",date:"",customer_id:"",mobile_no:"",amc_type:"",email:"",discount:"",billing_address:"",sales_details:[]});p.useEffect(()=>{d(l=>({...l,sales_details:c||[]}))},[c]);function C(l){l.preventDefault(),T(route("sales.store"),{onSuccess:()=>{b.success("sales added successfully!")},onError:()=>{b.error("Failed to add sales. Please check your inputs.")}})}return e.jsx(A,{children:e.jsxs("div",{className:"max-w-5xl p-8 mx-auto bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"mb-6 text-2xl font-bold text-gray-800",children:"Add Sales"}),e.jsxs("form",{onSubmit:C,className:"flex flex-wrap",children:[e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Bill No."}),e.jsx("input",{readOnly:!0,value:r.bill_no,type:"text",className:"w-full rounded form-input",placeholder:"Enter bill no"}),s.bill_no&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.bill_no})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Status"}),e.jsxs("select",{name:"status",onChange:l=>d("status",l.target.value),value:r.status,className:"w-full rounded form-select",id:"",children:[e.jsx("option",{value:"",children:"-- Select Status --"}),e.jsx("option",{value:"unpaid",children:"Unpaid"}),e.jsx("option",{value:"full_paid",children:"Full Paid"}),e.jsx("option",{value:"half_paid",children:"Half Paid"})]}),s.status&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.status})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Sales Date"}),e.jsx("input",{type:"date",name:"date",onChange:l=>d("date",l.target.value),value:r.date,className:"w-full rounded form-input",placeholder:"Enter bill no"}),s.date&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.date})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Customer Name"}),e.jsxs("select",{name:"",onChange:l=>d("customer_id",l.target.value),value:r.customer_id,className:"w-full rounded form-select",id:"",children:[e.jsx("option",{value:"",children:"-- Select Customer --"}),h&&h.map((l,a)=>e.jsx("option",{value:l.user_id,children:l.first_name+" "+l.middle_name+" "+l.last_name},a))]}),s.customer_id&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.customer_id})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Mobile No"}),e.jsx("input",{type:"tel",onChange:l=>d("mobile_no",l.target.value),value:r.mobile_no,className:"w-full rounded form-input",placeholder:"Enter mobile no"}),s.mobile_no&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.mobile_no})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"AMC Type"}),e.jsxs("select",{name:"",onChange:l=>d("amc_type",l.target.value),value:r.amc_type,className:"w-full rounded form-select",id:"",children:[e.jsx("option",{value:"no_amc",children:"No AMC"}),e.jsx("option",{value:"amc",children:"AMC"})]}),s.amc_type&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.amc_type})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Email"}),e.jsx("input",{type:"email",onChange:l=>d("email",l.target.value),value:r.email,className:"w-full rounded form-input",placeholder:"Enter email"}),s.email&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.email})]}),e.jsxs("div",{className:"flex flex-col w-1/2 gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Discount"}),e.jsx("input",{type:"number",onChange:l=>d("discount",l.target.value),value:r.discount,className:"w-full rounded form-input",placeholder:"Enter discount"}),s.discount&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.discount})]}),e.jsxs("div",{className:"flex flex-col w-full gap-2 p-2",children:[e.jsx("label",{htmlFor:"",children:"Billing Address"}),e.jsx("textarea",{name:"",onChange:l=>d("billing_address",l.target.value),value:r.billing_address,id:"",rows:2,className:"w-full rounded resize-none form-textarea"}),s.billing_address&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:s.billing_address})]}),e.jsx("hr",{}),e.jsx("div",{className:"w-full py-2",children:e.jsx("h1",{className:"text-xl font-semibold text-gray-600",children:"Sales Details"})}),e.jsxs("div",{className:"w-full py-2",children:[e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border border-gray-300",children:"Product"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Quantity"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Price (Af)"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Tax"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Amount (Af)"}),e.jsx("th",{className:"p-2 border border-gray-300",children:"Action"})]})}),e.jsx("tbody",{children:c.map((l,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:e.jsxs("select",{className:"w-full rounded form-select",value:l.product,onChange:t=>u(a,"product",t.target.value),children:[e.jsx("option",{value:"",children:"-- Select Product --"}),j&&j.map((t,n)=>e.jsx("option",{value:t.item_name,children:t.item_name},n))]})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full rounded form-input",value:l.quantity,onChange:t=>u(a,"quantity",t.target.value)})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full rounded form-input",value:l.price,onChange:t=>u(a,"price",t.target.value)})}),e.jsx("td",{className:"p-2",children:e.jsx(E,{options:g.map(t=>({name:`${t.name} (${t.percent}%)`,percent:t.percent})),onSelect:t=>f(a,t),onRemove:t=>f(a,t),displayValue:"name"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{type:"number",className:"w-full rounded form-input",value:l.amountWithTax.toFixed(2),readOnly:!0})}),e.jsx("td",{className:"p-2",children:a!==0&&e.jsxs("button",{type:"button",className:"flex items-center gap-1 text-sm font-medium text-red-500",onClick:()=>w(a),children:[e.jsx(F,{size:15}),e.jsx("span",{children:"Delete"})]})})]},a))})]}),e.jsx("button",{type:"button",className:"px-4 py-2 mt-4 text-white bg-blue-500 rounded",onClick:_,children:"Add Row"})]}),e.jsx("div",{className:"w-full py-5",children:e.jsx("button",{className:"px-6 py-2 text-sm font-medium text-white rounded bg-rose-600",children:"Add Sale"})})]})]})})}export{$ as default};
